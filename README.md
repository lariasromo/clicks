# Clickstream Pipeline
This project intention is to capture key concepts, decisions and motivations about the strategy to parse, store
and analyse clickstream data to accomodate future queries and aggregations for our internal departments (data
science, sales, marketing, etc..) bringing valued insights about our user clickstream activity.

![](docs/flow.png)

### Format of source message
There are 2 main sources of clickstream: mobile and web.
Where each source is present on the topics: `adjust` and `topicaudience` respectively

### Example of messages
- ### Adjust
```text
/adjust_events?app_id=1078997450&store=itunes&tracker=7b0a6t7&tracker_name=affiliates_clearpier_mobile%3A%3ALibertex+IOS-IDFA-LATAM-Non+incent-CPA-+Direct%3A%3Aclearpiersg%3A%3A4db9086394e810bc&network_name=affiliates_clearpier_mobile&campaign_name=Libertex+IOS-IDFA-LATAM-Non+incent-CPA-+Direct&adgroup_name=clearpiersg&creative_name=4db9086394e810bc&user_agent=Mozilla%252F5.0%2520%2528iPhone%253B%2520CPU%2520iPhone%2520OS%252015_1%2520like%2520Mac%2520OS%2520X%2529%2520AppleWebKit%252F605.1.15%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Version%252F15.1%2520Mobile%252F15E148&ip_address=179.33.39.134&click_time=1654712841&created_at=1654712841&country=co&os_name=server&activity_kind=click&idfa=D8B70EF1-A139-4A14-AD1E-3BBF54537FDA&gps_adid=d8b70ef1-a139-4a14-ad1e-3bbf54537fda
/adjust_events?app_id=1471506070&store=itunes&tracker=6vrcmqj&tracker_name=affiliate_topoffers_storm%3A%3AiOS_TT11dd%3A%3A2&network_name=affiliate_topoffers_storm&campaign_name=iOS_TT11dd&adgroup_name=2&user_agent=Mozilla%2F5.0+%28iPhone%3B+CPU+iPhone+OS+15_4_1+like+Mac+OS+X%29+AppleWebKit%2F605.1.15+%28KHTML%2C+like+Gecko%29+Mobile%2F15E148&ip_address=43.133.162.180&click_time=1654712841&created_at=1654712841&country=jp&device_name=iPhone&os_name=ios&os_version=15.4.1&activity_kind=click&idfa=23705C2A-D6BC-4EFD-8B68-58D9A1C95A47&gps_adid=23705c2a-d6bc-4efd-8b68-58d9a1c95a47&attribution_type=all
/adjust_events?app_id=1471506070&app_version=75&store=itunes&tracker=ad14k2j&tracker_name=Organic&network_name=Organic&adid=9bfeccbda551c9ffa916485c58c63bce&user_agent=StormGain%2F75+CFNetwork%2F1333.0.4+Darwin%2F21.5.0&ip_address=46.114.168.116&installed_at=1654622405&created_at=1654712811&country=de&device_name=iPhoneXR&os_name=ios&sdk_version=cordova4.29.1%40ios4.29.6&os_version=15.5&session_count=6&environment=production&tracking_enabled=1&timezone=UTC%2B0200&last_time_spent=27&activity_kind=session&idfa=50D9770B-4B56-498A-82C4-C3D12B3BA52F&attribution_type=all&att_status=3&partner_parameters=%7B%22ClientID%22%3A%22140500293%22%2C%22isFirstLaunch%22%3A%220%22%7D
/adjust_events?app_id=1471506070&store=itunes&tracker=yd4erdm&tracker_name=affiliate_mobupps_storm%3A%3AMobupps_Domobi_GEO%3A%3Amobupps%3A%3A%28share_source_info%29&network_name=affiliate_mobupps_storm&campaign_name=Mobupps_Domobi_GEO&adgroup_name=mobupps&creative_name=%28share_source_info%29&click_time=1654672882&created_at=1654672882&region=fr&country=fr&os_name=ios&activity_kind=click&idfa=F08F2D62-6F6F-4346-75FF-6513699D369E&attribution_type=all
/adjust_events?app_id=com.libertex.mobile&store=google&tracker=7ohu57n&tracker_name=adcolony_mobile%3A%3AEE%2F%3A%3A_libertex_gp_tier2+Android%3A%3AEN_compl_CS-1542_zero-fee-crypto_23s_16-9_v1_crid6ed70af5_Android&network_name=adcolony_mobile&campaign_name=EE%2F&adgroup_name=_libertex_gp_tier2+Android&creative_name=EN_compl_CS-1542_zero-fee-crypto_23s_16-9_v1_crid6ed70af5_Android&ip_address=91.131.59.35&click_time=1654672883&created_at=1654672883&country=ee&os_name=server&activity_kind=click&gps_adid=29b37035-5b0d-4691-bf84-0252b199ee46&label=Family+Island%E2%84%A2+-+Farm+game+adventure&pub_id=Family+Island%E2%84%A2+-+Farm+game+adventure
/adjust_events?app_id=1078997450&store=itunes&tracker=b45141l&tracker_name=affiliates_clearpier_mobile%3A%3ALibertex+IOS-IDFA-LATAM-Non+incent-CPA-+Direct%3A%3Aclearpiersg%3A%3A2e63365352dcfc9c&network_name=affiliates_clearpier_mobile&campaign_name=Libertex+IOS-IDFA-LATAM-Non+incent-CPA-+Direct&adgroup_name=clearpiersg&creative_name=2e63365352dcfc9c&user_agent=Mozilla%252F5.0%2520%2528iPhone%253B%2520CPU%2520iPhone%2520OS%252015_1%2520like%2520Mac%2520OS%2520X%2529%2520AppleWebKit%252F605.1.15%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Version%252F15.1%2520Mobile%252F15E148&ip_address=177.225.133.45&click_time=1654672884&created_at=1654672884&country=mx&os_name=server&activity_kind=click&idfa=8D0C3800-CB58-472F-8BAA-3093E6A64A37&gps_adid=8d0c3800-cb58-472f-8baa-3093e6a64a37
/adjust_events?app_id=org.fxclub.libertex&store=google&tracker=nw4nkie&tracker_name=affiliate_mobihero_mobile%3A%3A%7B%7B%7Bcountry%7D%7D%7D%3A%3Amobihero_12665357_87906%3A%3A%28share_source_info%29&network_name=affiliate_mobihero_mobile&campaign_name=%7B%7B%7Bcountry%7D%7D%7D&adgroup_name=mobihero_12665357_87906&creative_name=%28share_source_info%29&click_time=1654672885&created_at=1654672885&region=ru&country=ru&os_name=android&activity_kind=click&gps_adid=b8431575-09e3-42bf-970a-c26ef7cdf581&reftag=cGCEs3BKsSXxn&attribution_type=all
/adjust_events?app_id=1140806268&store=itunes&tracker=1saz62l&tracker_name=affiliate_iris_mobile%3A%3ADE%3A%3Airis&network_name=affiliate_iris_mobile&campaign_name=DE&adgroup_name=iris&user_agent=Mozilla%2F5.0+%28iPhone%3B+CPU+iPhone+OS+15_5+like+Mac+OS+X%29+AppleWebKit%2F605.1.15+%28KHTML%2C+like+Gecko%29+Mobile%2F15E148&ip_address=91.20.1.92&click_time=1654672886&created_at=1654672886&region=de&country=de&language=de&device_name=iPhone&os_name=ios&os_version=15.5&activity_kind=click&idfa=BEAC3EC6-A7C0-43DD-97C8-19A0C43B2B92
/adjust_events?app_id=org.fxclub.libertex&store=google&tracker=f997xx1&tracker_name=tapjoy_mobile%3A%3AKG%3A%3A7a70c7d3aebe0463dd0e1d13d62df0f0a766e22a645a71f8c89f941219a6bbf263bd9624fdb963eebd2eaab2408109a49fb5c3a4e7dad7149e4baddfe31d8784ca51817ab934ab64bb037b49848ac54229c6df0b9adff203670b2bdcb2ff6737%3A%3AApple&network_name=tapjoy_mobile&campaign_name=KG&adgroup_name=7a70c7d3aebe0463dd0e1d13d62df0f0a766e22a645a71f8c89f941219a6bbf263bd9624fdb963eebd2eaab2408109a49fb5c3a4e7dad7149e4baddfe31d8784ca51817ab934ab64bb037b49848ac54229c6df0b9adff203670b2bdcb2ff6737&creative_name=Apple&user_agent=Mozilla%2F5.0+%28Linux%3B+Android+11%3B+M2003J15SC+Build%2FRP1A.200720.011%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F101.0.4951.61+Mobile+Safari%2F537.36&ip_address=212.2.235.32&click_time=1654672887&created_at=1654672887&country=kg&device_name=Note9&os_name=android&os_version=11&activity_kind=click&gps_adid=8a9120da-b7ef-40dd-bc61-29d0bfe542b8&label=7a70c7d3aebe0463dd0e1d13d62df0f0a766e22a645a71f8c89f941219a6bbf263bd9624fdb963eebd2eaab2408109a49fb5c3a4e7dad7149e4baddfe31d8784ca51817ab934ab64bb037b49848ac54229c6df0b9adff203670b2bdcb2ff6737&reftag=c470Djvx8xAz3&attribution_type=all&pub_id=7a70c7d3aebe0463dd0e1d13d62df0f0a766e22a645a71f8c89f941219a6bbf263bd9624fdb963eebd2eaab2408109a49fb5c3a4e7dad7149e4baddfe31d8784ca51817ab934ab64bb037b49848ac54229c6df0b9adff203670b2bdcb2ff6737
/adjust_events?app_id=org.fxclub.libertex&store=google&tracker=5tys986&tracker_name=tapjoy_mobile%3A%3AHN%3A%3Ad9323e919b2e88eb8edf4b5151d9f51f0e064c368532fc1c2298ecc8562ae0281b8995d4d23a88fb107cfe4a7f4d91f8f1898b099000734f34564b8082731bbc232b1564887cd772d71002b9488e5847c59ee7100bc5d2798e42c57b5459b405%3A%3ALBX+Miner&network_name=tapjoy_mobile&campaign_name=HN&adgroup_name=d9323e919b2e88eb8edf4b5151d9f51f0e064c368532fc1c2298ecc8562ae0281b8995d4d23a88fb107cfe4a7f4d91f8f1898b099000734f34564b8082731bbc232b1564887cd772d71002b9488e5847c59ee7100bc5d2798e42c57b5459b405&creative_name=LBX+Miner&user_agent=Mozilla%2F5.0+%28Linux%3B+Android+11%3B+M2003J15SC+Build%2FRP1A.200720.011%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F102.0.5005.78+Mobile+Safari%2F537.36&ip_address=200.52.145.122&click_time=1655081319&created_at=1655081319&country=hn&device_name=Note9&os_name=android&os_version=11&activity_kind=click&gps_adid=128a9cf7-1ef8-41d8-b601-617d2fbf4d71&label=d9323e919b2e88eb8edf4b5151d9f51f0e064c368532fc1c2298ecc8562ae0281b8995d4d23a88fb107cfe4a7f4d91f8f1898b099000734f34564b8082731bbc232b1564887cd772d71002b9488e5847c59ee7100bc5d2798e42c57b5459b405&reftag=chu7XNonLOL6Q&attribution_type=all&pub_id=d9323e919b2e88eb8edf4b5151d9f51f0e064c368532fc1c2298ecc8562ae0281b8995d4d23a88fb107cfe4a7f4d91f8f1898b099000734f34564b8082731bbc232b1564887cd772d71002b9488e5847c59ee7100bc5d2798e42c57b5459b405
/adjust_events?app_id=org.fxclub.libertex&store=google&tracker=52o6bsz&tracker_name=adcolony_mobile%3A%3ADO%2F%3A%3A_LATAM+BUNDLE+Android%3A%3AES-LA_nonCompl_CS-1830_LBXMiner_22s_16-9_v1_cridbe61ca9d_Android&network_name=adcolony_mobile&campaign_name=DO%2F&adgroup_name=_LATAM+BUNDLE+Android&creative_name=ES-LA_nonCompl_CS-1830_LBXMiner_22s_16-9_v1_cridbe61ca9d_Android&user_agent=Mozilla%2F5.0+%28Linux%3B+Android+10%3B+SM-A205U+Build%2FQP1A.190711.020%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F102.0.5005.78+Mobile+Safari%2F537.36&ip_address=37.148.217.10&click_time=1655081320&created_at=1655081320&country=do&language=es&device_name=GalaxyA20&os_name=android&os_version=10&activity_kind=click&gps_adid=2740b00c-f1af-4e1f-bb80-3e0a7224d50d&label=Stick+Superheroes+Supreme+Game&cost_type=CPI&cost_amount=1.5&cost_currency=USD&reporting_cost=1.5&cost_id_md5=4eda669d739114a56a973749925a4269&reftag=cyljKRT1WDLOw&attribution_type=all&pub_id=Stick+Superheroes+Supreme+Game
/adjust_events?app_id=org.fxclub.libertex&store=google&tracker=g5h5je4&tracker_name=tapjoy_mobile%3A%3AMX%3A%3Ac37498d26aa63fbfa37ac32f786650b89ef0d4da113afc526b10f31f2cc75e084884820e0365b409ebb4cb5118a6ce5df2b1430baf925c281312b7b27ec44ed7ef12a28f9195762ec72394e6f84ed4f5007c88ccff1d30e144a5b134bf6a56e1%3A%3ALBX+Miner&network_name=tapjoy_mobile&campaign_name=MX&adgroup_name=c37498d26aa63fbfa37ac32f786650b89ef0d4da113afc526b10f31f2cc75e084884820e0365b409ebb4cb5118a6ce5df2b1430baf925c281312b7b27ec44ed7ef12a28f9195762ec72394e6f84ed4f5007c88ccff1d30e144a5b134bf6a56e1&creative_name=LBX+Miner&user_agent=Mozilla%2F5.0+%28Linux%3B+Android+11%3B+SM-A107M+Build%2FRP1A.200720.012%3B+wv%29+AppleWebKit%2F537.36+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Chrome%2F102.0.5005.99+Mobile+Safari%2F537.36&ip_address=200.68.170.27&click_time=1655081320&created_at=1655081320&country=mx&device_name=GalaxyA10s&os_name=android&os_version=11&activity_kind=click&gps_adid=9b0b4e7b-fd13-4e5e-8e66-ecc85d994853&label=c37498d26aa63fbfa37ac32f786650b89ef0d4da113afc526b10f31f2cc75e084884820e0365b409ebb4cb5118a6ce5df2b1430baf925c281312b7b27ec44ed7ef12a28f9195762ec72394e6f84ed4f5007c88ccff1d30e144a5b134bf6a56e1&reftag=cckWFWlGqU9Fd&attribution_type=all&pub_id=c37498d26aa63fbfa37ac32f786650b89ef0d4da113afc526b10f31f2cc75e084884820e0365b409ebb4cb5118a6ce5df2b1430baf925c281312b7b27ec44ed7ef12a28f9195762ec72394e6f84ed4f5007c88ccff1d30e144a5b134bf6a56e1
/adjust_events?app_id=1481211100&store=itunes&tracker=yy7ounn&tracker_name=adcolony_mobile%3A%3APY%2F%3A%3A_LATAM+BUNDLE+iOS%3A%3AES-LA_nonCompl_CS-1830_LBXMiner_22s_16-9_v1_cridbe61ca9d_iOS&network_name=adcolony_mobile&campaign_name=PY%2F&adgroup_name=_LATAM+BUNDLE+iOS&creative_name=ES-LA_nonCompl_CS-1830_LBXMiner_22s_16-9_v1_cridbe61ca9d_iOS&user_agent=Mozilla%2F5.0+%28iPhone%3B+CPU+iPhone+OS+15_5+like+Mac+OS+X%29+AppleWebKit%2F605.1.15+%28KHTML%2C+like+Gecko%29+Mobile%2F15E148&ip_address=170.83.242.246&click_time=1655081323&created_at=1655081323&country=py&language=es&device_name=iPhone&os_name=ios&os_version=15.5&activity_kind=click&idfa=8DEC348B-7B85-4391-AB0A-75BBD17F2B4C&label=Sniper+Strike+iOS&attribution_type=all
```
- ### Audience
```text
/?t_profile=ep-web&visitor_id=018144f92c92009b8a16e98a46d00007800b107000638&client_id=&segment_web=&product_name=&sf_campaignId=&page_system=promo&page_language=en&page_channel=&product_subcategory=&page_dom_url=https%3A%2F%2Fpromo.stormgain.com%2Flp%2Fen-en%2Fmining2%2F%3Fbinom_click_id%3D4fdb7g6ho6jscde6%26utm_id%3D1E1n%26utm_source%3Dcoinzilla_storm%26utm_medium%3Dmedia%26utm_campaign%3Dphone_old_miner%26utm_country%3Den&customer_profile_lifecycle=&session_id=1654719589524&customer_profile_is_first_launch_open=&customer_cur_account_type=&customer_cur_account_is_deposit=&customer_cur_account_info_code=&customer_cur_account_id=&customer_cur_account_deposit_total_value=&customer_cur_account_deposit_init_value=&customer_cur_account_count_of_deals_total=&customer_cur_account_balance_available=&customer_accounts_info_code=&customer_email=&customer_profile_broker=&icid_sf=&page_referrer_long=&page_dom_referrer=https%3A%2F%2Frequest-global.czilladx.com%2Fserve%2Fview.php%3Fw%3DPOPUNDER%26h%3D%26z%3D753627265d76df00769%26c%3D9005eeb45fb73470158%26n%3D1ec1ec40083d8f969da3e0cbeabae5ed367794be56fab1c02d23af26b98fc6b8%26integrity%3DeyJrZXkiOiJlZTU2MWMzYzc2NDNiOWU2ODRkY2Y3MWFmNDZkMGRmNGI0OTk2MzMwNzI4NzM5ZjRjYmMwMzJiNjk1YmRhZmY4IiwidGltZXN0YW1wIjoxNjU0NzE5NTY1LjcwMzc4OSwiaWRlbnRpZmllciI6ImMyMTZhZjZiNGE4ZjI5MmQ0MTAzMjJjM2E3ZDg3MzY0MzExNjc4ZDU5ZjI2MDMyNjBmOGVmNTlhZGVjYTFmOTQifQ&page_category=&page_environment=prod&event_date=&event_account_name=&event_account_id=&customer_login=&event_value=&event_id=&event_type=&product_category=&customer_id=&page_path=&customer_profile_country=&customer_profile_phone=&product_id=&fx_visitor_id=&abtest_experiments_name=&abtest_experiments_bucket=&page_loadingtime=&page_loadingtime_tti=&page_dom_referrer_original=https%3A%2F%2Frequest-global.czilladx.com%2Fserve%2Fview.php%3Fw%3DPOPUNDER%26h%3D%26z%3D753627265d76df00769%26c%3D9005eeb45fb73470158%26n%3D1ec1ec40083d8f969da3e0cbeabae5ed367794be56fab1c02d23af26b98fc6b8%26integrity%3DeyJrZXkiOiJlZTU2MWMzYzc2NDNiOWU2ODRkY2Y3MWFmNDZkMGRmNGI0OTk2MzMwNzI4NzM5ZjRjYmMwMzJiNjk1YmRhZmY4IiwidGltZXN0YW1wIjoxNjU0NzE5NTY1LjcwMzc4OSwiaWRlbnRpZmllciI6ImMyMTZhZjZiNGE4ZjI5MmQ0MTAzMjJjM2E3ZDg3MzY0MzExNjc4ZDU5ZjI2MDMyNjBmOGVmNTlhZGVjYTFmOTQifQ&event_date_utc=2022-05-02%2008%3A19&page_activitytime=&mixlib=undefined&ga_cid=undefined&page_type=
/?t_profile=ep-android&visitor_id=01806f57c1cf001e89392905d89b0009e0098096004b3&client_id=&sf_campaignId=&product_name=&page_system=stormgain&page_language=en&page_channel=sg-android&product_subcategory=&page_dom_url=&customer_profile_lifecycle=&session_id=1651135463889&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=&customer_cur_account_is_deposit=&customer_cur_account_info_code=&customer_cur_account_id=&customer_cur_account_deposit_total_value=&customer_cur_account_deposit_init_value=&customer_cur_account_count_of_deals_total=&customer_cur_account_balance_available=&customer_accounts_info_code=&customer_email=&customer_profile_broker=storm&customer_profile_business_unit=&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-04-28%2008%3A44&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=order&event_type_condition_multiplicator=&event_type_condition_direction=&event_type_condition_value=&customer_account_nbc_wallet_currency=&customer_account_is_nbc_activated=&customer_account_is_nbc_activated_date=&customer_account_nbc_deposit_total_value=&customer_account_nbc_deposit_total_count=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_init_value=&customer_account_nbc_deposit_init_date=&customer_account_nbc_balance_available=&customer_account_count_of_nbc_closed_orders_sbs_ch+&customer_account_count_of_nbc_closed_orders_sbs_rc=&customer_account_count_of_nbc_closed_orders_abs_ch=&customer_account_count_of_nbc_closed_orders_abs_rc=&customer_account_bc_is_activated=&customer_account_is_bc_activated_date=&customer_account_count_of_pending_exchange_orders=&customer_account_is_deposit=&customer_account_bc_deposit_init_value=&customer_account_count_of_trades_close=&customer_account_trades_closed_list=&customer_account_bc_deposit_total_value&customer_account_bc_deposit_last_date=&customer_account_bc_deposit_total_count=&customer_account_bc_deposit_last_value=&customer_account_bc_balance_available=&customer_account_count_of_closed_orders_sbs=&customer_account_count_of_closed_orders_abs=&customer_account_count_of_pending_orders=&customer_account_pending_orders_value=&customer_account_count_of_trades_total=&customer_account_info_code=&customer_profile_network=&customer_profile_adgroup=&customer_profile_creative=&product_category=session%20resumed&customer_id=&page_path=https%3A%2F%2Fapp.stormgain.app%2Fm&page_name=Home&customer_profile_country=&product_id=&page_loadingtime=&fx_visitor_id=02583f5877cf924a5d373cde6f6038cab3e674f69d663e8148dfb3250782ae66&device=Google%20Pixel%203&Device=&page_loadingtime_tti=&page_activitytime=&page_type=
"/?t_profile=main&visitor_id=0180761930a50015fd21a2b2c8c505074001a06c00bd0&client_id=38039602&segment_web=a&product_name=&sf_campaignId=&page_system=libertex&page_language=hk&page_channel=web&product_subcategory=&page_dom_url=https%3A%2F%2Fapp.libertex.org%2Fproducts%2Fcurrency%2FEURUSD%2F&customer_profile_lifecycle=&customer_profile_network=&customer_profile_network_name=&session_id=1652801554297&customer_profile_is_first_launch_open=0&customer_cur_account_type=demo&customer_cur_account_is_deposit=NaN&customer_cur_account_info_code=10039&customer_cur_account_id=1910679789&customer_cur_account_deposit_total_value=NaN&customer_cur_account_deposit_init_value=NaN&customer_cur_account_count_of_deals_total=1&customer_cur_account_balance_available=49999.830000000000000&customer_accounts_info_code=39,10039&customer_email=wallace.taller.liu%40gmail.com&customer_profile_broker=bvi&customer_profile_business_unit=BU%20China&icid_sf=&page_referrer_long=&page_dom_referrer=https%3A%2F%2Fapp.libertex.org%2Fproducts%2Fcurrency%2FEURUSD%2F&page_category=&page_environment=prod&event_date_utc=2022-05-17%2015%3A52&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=click&product_category=tv%20indicators&customer_id=38039602&page_path=app.libertex.org%2Fproducts%2Fcurrency%2FEURUSD%2F&page_name=EURUSD%20%7C%20EUR%2FUSD&customer_profile_country=TWN&product_id=&fx_visitor_id=569581f172ffdafb9752bc10a5cc22aa2cbb3738ebc3baa7d816ef257a3bf942&abtest_experiments_name=&abtest_experiments_bucket=&page_loadingtime=&page_loadingtime_tti=&page_activitytime=&mixlib=object&ga_cid=1225765182.1652279726&page_type="
"/?t_profile=nmpandroid&visitor_id=0181568174aa0040d48d8d404738000a0009609800547&client_id=40231792&sf_campaignId=&product_name=&page_system=libertex&page_language=uk&page_channel=nmp_android&product_subcategory=deposit&page_dom_url=&customer_profile_lifecycle=&session_id=1655013733554&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=0&customer_cur_account_info_code=65&customer_cur_account_id=1811254189&customer_cur_account_deposit_total_value=0&customer_cur_account_deposit_init_value=0&customer_cur_account_count_of_deals_total=0&customer_cur_account_balance_available=0.000000000000000&customer_accounts_info_code=65,10065&customer_email=sipkogalina06%40gmail.com&customer_profile_broker=bvi&customer_profile_business_unit=BU%20Ukraine&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=&event_account_name=&event_account_id=&event_ref=balance&event_currency=&customer_login=&event_value=&event_id=&event_type=click&product_category=wallet&customer_id=40231792&page_path=https%3A%2F%2Flibertex.fxclub.org%2Fm%23deposit&page_name=Deposit&customer_profile_country=UKR&product_id=&page_loadingtime=&fx_visitor_id=bad24cf66e3a77e6321196cb94f097ca428d5b16377f427233e16d5962dd5fca&customer_profile_network=ironsource_mobile&customer_profile_network_name=&device=HMD%20Global%20Nokia%20G20&Device=&page_loadingtime_tti=&page_activitytime=&page_type="
"/?t_profile=nmpandroid&visitor_id=017a10200075001ebf8d4439bbf8000a0009609800547&client_id=23871781&sf_campaignId=&product_name=Ethereum&page_system=libertex&page_language=de&page_channel=nmp_android&product_subcategory=crypto&page_dom_url=&customer_profile_lifecycle=&session_id=1655011991261&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=1&customer_cur_account_info_code=9&customer_cur_account_id=2804164966&customer_cur_account_deposit_total_value=5500.000000000000000&customer_cur_account_deposit_init_value=500.000000000000000&customer_cur_account_count_of_deals_total=205&customer_cur_account_balance_available=0.020000000000000&customer_accounts_info_code=9,10009&customer_email=info%40gm-bl.de&customer_profile_broker=cypb&customer_profile_business_unit=BU%20CySEC&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=2022-06-12%2006%3A06%3A01&event_account_name=libertex&event_account_id=2804164966&event_ref=&event_currency=eur&customer_login=&event_value=NaN&event_id=40842826&event_type=edit&product_category=active_investment&customer_id=23871781&page_path=https%3A%2F%2Fapp.libertex.com%2Fm%23investments%2Factive%2FETHUSD%2F40842826&page_name=Trade%20report&customer_profile_country=DEU&product_id=ETHUSD&page_loadingtime=&fx_visitor_id=ca93649b9082f0e17ed66ae565ee6135c39174cfa3cc7ed5daf7416f34f3f1ae&customer_profile_network=Google%20Ads%20ACI&customer_profile_network_name=&device=Samsung%20SM-G985F&Device=&page_loadingtime_tti=&page_activitytime=&page_type="
"/?t_profile=nmpiosnew&visitor_id=0180ef86072d00221f7dff501a1c0006f009a06700432&client_id=40058642&sf_campaignId=&product_name=&page_system=libertex&page_language=uk&page_channel=nmp_ios&product_subcategory=new&page_dom_url=&customer_profile_lifecycle=&session_id=1655008991070&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=1&customer_cur_account_info_code=39&customer_cur_account_id=1811237283&customer_cur_account_deposit_total_value=108.690000000000000&customer_cur_account_deposit_init_value=108.690000000000000&customer_cur_account_count_of_deals_total=2&customer_cur_account_balance_available=0.190000000000000&customer_accounts_info_code=39,10039&customer_email=andry.smetanyuk%40bk.ru&customer_profile_broker=bvi&customer_profile_business_unit=BU%20Ukraine&customer_profile_network=Apple%20Search%20Ads&customer_profile_network_name=&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=close&product_category=tp%20and%20sl&customer_id=40058642&page_path=https%3A%2F%2Flibertex.fxclub.org%2Fm%23new-investment%2FBTCUSD%2F%257B%2522direction%2522%253A%2522growth%2522%257D&page_name=Invest&customer_profile_country=UKR&product_id=&page_loadingtime=&fx_visitor_id=113079d44a2e45aa74bffa8fb56a9065ee1bf653ba5b28f9f11d95e52e0312d3&device=iPhone%207&Device=&page_loadingtime_tti=&page_activitytime=&page_type=&"
"/?t_profile=nmpandroid&visitor_id=0177f8bec3ac008fc4bb74bd02e0000a00096098004a0&client_id=21448931&sf_campaignId=&product_name=Bitcoin&page_system=libertex&page_language=de&page_channel=nmp_android&product_subcategory=crypto&page_dom_url=&customer_profile_lifecycle=&session_id=1655013834327&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=1&customer_cur_account_info_code=9&customer_cur_account_id=2803923283&customer_cur_account_deposit_total_value=4720.000000000000000&customer_cur_account_deposit_init_value=130.000000000000000&customer_cur_account_count_of_deals_total=1626&customer_cur_account_balance_available=0.030000000000000&customer_accounts_info_code=9,10010&customer_email=mimmo_russo%40hotmail.de&customer_profile_broker=cypb&customer_profile_business_unit=BU%20CySEC&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=2022-06-12%2006%3A06%3A03&event_account_name=libertex&event_account_id=2803923283&event_ref=&event_currency=eur&customer_login=&event_value=NaN&event_id=40836537&event_type=edit&product_category=active_investment&customer_id=21448931&page_path=https%3A%2F%2Fapp.libertex.com%2Fm%23investments%2Factive%2FBTCUSD%2F40836537&page_name=Trade%20report&customer_profile_country=DEU&product_id=BTCUSD&page_loadingtime=&fx_visitor_id=9e5548a9524bff843dc4dc4ad43e4f8ccce7ce11648c8d72aafb6d5e38f6761d&customer_profile_network=Google%20Ads%20ACI&customer_profile_network_name=&device=Samsung%20SM-G985F&Device=&page_loadingtime_tti=&page_activitytime=&page_type="
/?t_profile=ep-android&visitor_id=018105493af9001339fb11791a77000a3009809b00478&client_id=63617163&sf_campaignId=&product_name=&page_system=stormgain&page_language=en&page_channel=sg-android&product_subcategory=&page_dom_url=&customer_profile_lifecycle=&session_id=1655013945891&customer_profile_is_first_launch_open=1&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=&customer_cur_account_info_code=&customer_cur_account_id=&customer_cur_account_deposit_total_value=&customer_cur_account_deposit_init_value=&customer_cur_account_count_of_deals_total=&customer_cur_account_balance_available=&customer_accounts_info_code=&customer_email=venumajhi%40gmail.com&customer_profile_broker=storm&customer_profile_business_unit=&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A05&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=close&event_type_condition_multiplicator=&event_type_condition_direction=&event_type_condition_value=&customer_account_nbc_wallet_currency=&customer_account_is_nbc_activated=&customer_account_is_nbc_activated_date=&customer_account_nbc_deposit_total_value=&customer_account_nbc_deposit_total_count=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_init_value=&customer_account_nbc_deposit_init_date=&customer_account_nbc_balance_available=&customer_account_count_of_nbc_closed_orders_sbs_ch+&customer_account_count_of_nbc_closed_orders_sbs_rc=&customer_account_count_of_nbc_closed_orders_abs_ch=&customer_account_count_of_nbc_closed_orders_abs_rc=&customer_account_bc_is_activated=&customer_account_is_bc_activated_date=&customer_account_count_of_pending_exchange_orders=&customer_account_is_deposit=&customer_account_bc_deposit_init_value=&customer_account_count_of_trades_close=&customer_account_trades_closed_list=&customer_account_bc_deposit_total_value&customer_account_bc_deposit_last_date=&customer_account_bc_deposit_total_count=&customer_account_bc_deposit_last_value=&customer_account_bc_balance_available=&customer_account_count_of_closed_orders_sbs=&customer_account_count_of_closed_orders_abs=&customer_account_count_of_pending_orders=&customer_account_pending_orders_value=&customer_account_count_of_trades_total=&customer_account_info_code=301&customer_profile_network=Organic&customer_profile_adgroup=&customer_profile_creative=&product_category=modal%20offer&customer_id=63617163&page_path=https%3A%2F%2Fapp.stormgain.com%2Fm%23margin-trading%2Factive&page_name=Margin%20trading&customer_profile_country=IND&product_id=mo_sg_less5_v2_en&page_loadingtime=&fx_visitor_id=52ee0a235681968aba739c324872a42ae3d3408bac882347da67f94d752811fe&device=Asus%20ASUS_X01BDA&Device=&page_loadingtime_tti=&page_activitytime=&page_type=
"/?t_profile=main&visitor_id=017f22e33d62002021db044d69d801075001906d0093c&client_id=37822332&segment_web=b&product_name=&sf_campaignId=&page_system=libertex&page_language=en&page_channel=web&product_subcategory=&page_dom_url=https%3A%2F%2Fapp.libertex.org%2F&customer_profile_lifecycle=&customer_profile_network=&customer_profile_network_name=&session_id=1655009503409&customer_profile_is_first_launch_open=0&customer_cur_account_type=demo&customer_cur_account_is_deposit=NaN&customer_cur_account_info_code=10047&customer_cur_account_id=1910663200&customer_cur_account_deposit_total_value=NaN&customer_cur_account_deposit_init_value=NaN&customer_cur_account_count_of_deals_total=241&customer_cur_account_balance_available=149803.230000000000000&customer_accounts_info_code=47,10047&customer_email=jmlomas1%40icloud.com&customer_profile_broker=bvi&customer_profile_business_unit=BU%20LatAm&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=click&product_category=closed%20trades&customer_id=37822332&page_path=app.libertex.org%2F&page_name=Main%20Portal&customer_profile_country=MEX&product_id=&fx_visitor_id=1bfcf9163baea56dd253c09080e41da2cd74010e7a024aba2b5ea66b59c3def9&abtest_experiments_name=New_FCIL_Commission_Return_Demo&abtest_experiments_bucket=New_FCIL_Commission_Return_Demo_C&page_loadingtime=&page_loadingtime_tti=&page_activitytime=&mixlib=object&ga_cid=1207648986.1649354309&page_type="
/?t_profile=ep-android&visitor_id=0180112e5d6700070d4c1324cc1b0009f0098097004a0&client_id=117086733&sf_campaignId=&product_name=&page_system=stormgain&page_language=pl&page_channel=sg-android&product_subcategory=&page_dom_url=&customer_profile_lifecycle=&session_id=1655013959264&customer_profile_is_first_launch_open=1&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=&customer_cur_account_info_code=&customer_cur_account_id=&customer_cur_account_deposit_total_value=&customer_cur_account_deposit_init_value=&customer_cur_account_count_of_deals_total=&customer_cur_account_balance_available=&customer_accounts_info_code=&customer_email=krystianstraznik2017%40gmail.com&customer_profile_broker=storm&customer_profile_business_unit=&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=close&event_type_condition_multiplicator=&event_type_condition_direction=&event_type_condition_value=&customer_account_nbc_wallet_currency=&customer_account_is_nbc_activated=&customer_account_is_nbc_activated_date=&customer_account_nbc_deposit_total_value=&customer_account_nbc_deposit_total_count=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_init_value=&customer_account_nbc_deposit_init_date=&customer_account_nbc_balance_available=&customer_account_count_of_nbc_closed_orders_sbs_ch+&customer_account_count_of_nbc_closed_orders_sbs_rc=&customer_account_count_of_nbc_closed_orders_abs_ch=&customer_account_count_of_nbc_closed_orders_abs_rc=&customer_account_bc_is_activated=&customer_account_is_bc_activated_date=&customer_account_count_of_pending_exchange_orders=&customer_account_is_deposit=&customer_account_bc_deposit_init_value=&customer_account_count_of_trades_close=&customer_account_trades_closed_list=&customer_account_bc_deposit_total_value&customer_account_bc_deposit_last_date=&customer_account_bc_deposit_total_count=&customer_account_bc_deposit_last_value=&customer_account_bc_balance_available=&customer_account_count_of_closed_orders_sbs=&customer_account_count_of_closed_orders_abs=&customer_account_count_of_pending_orders=&customer_account_pending_orders_value=&customer_account_count_of_trades_total=&customer_account_info_code=101&customer_profile_network=Organic&customer_profile_adgroup=&customer_profile_creative=&product_category=modal%20offer&customer_id=117086733&page_path=https%3A%2F%2Fapp.stormgain.com%2Fm%23crypto-miner&page_name=Crypto%20Miner&customer_profile_country=POL&product_id=mo_sg_less20_v2_pl&page_loadingtime=&fx_visitor_id=ad668c261ee4fc06cd32bbb331ddd163ce36944943a24968d77d7244dad4a40f&device=Samsung%20SM-G781B&Device=&page_loadingtime_tti=&page_activitytime=&page_type=
"/?t_profile=nmpandroid&visitor_id=0181568174aa0040d48d8d404738000a0009609800547&client_id=40231792&sf_campaignId=&product_name=&page_system=epg&page_language=uk&page_channel=nmp_android&product_subcategory=creditcards&page_dom_url=&customer_profile_lifecycle=registeredprospect&session_id=1655013733554&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=0&customer_cur_account_info_code=65&customer_cur_account_id=1811254189&customer_cur_account_deposit_total_value=0&customer_cur_account_deposit_init_value=0&customer_cur_account_count_of_deals_total=0&customer_cur_account_balance_available=0.000000000000000&customer_accounts_info_code=65,10065&customer_email=sipkogalina06%40gmail.com&customer_profile_broker=bvi&customer_profile_business_unit=BU%20Ukraine&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=pay&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=2022-06-12%2006%3A06&event_account_name=invest&event_account_id=1811254189&event_ref=&event_currency=usd&customer_login=&event_value=100&event_id=&event_type=list&product_category=deposit&customer_id=40231792&page_path=%2Finit%2Fauthorize%2Fdp%3Ftoken%3Dlk0c9591di21jvb20d3bu04boo&page_name=pay_epg&customer_profile_country=UKR&product_id=&page_loadingtime=3852&fx_visitor_id=bad24cf66e3a77e6321196cb94f097ca428d5b16377f427233e16d5962dd5fca&customer_profile_network=ironsource_mobile&customer_profile_network_name=&device=HMD%20Global%20Nokia%20G20&Device=&page_loadingtime_tti=2699&page_activitytime=&page_type=upp-method-first"
"/?t_profile=nmpandroid&visitor_id=0177122fb1230020c4b75ed8c2dc0009f009509700464&client_id=17620771&sf_campaignId=&product_name=Bitcoin&page_system=libertex&page_language=de&page_channel=nmp_android&product_subcategory=crypto&page_dom_url=&customer_profile_lifecycle=&session_id=1655009367859&customer_profile_is_first_launch_open=0&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=1&customer_cur_account_info_code=37&customer_cur_account_id=2803540796&customer_cur_account_deposit_total_value=800.000000000000000&customer_cur_account_deposit_init_value=500.000000000000000&customer_cur_account_count_of_deals_total=1101&customer_cur_account_balance_available=0.600000000000000&customer_accounts_info_code=37,10010&customer_email=guenther.brugger1973%40gmail.com&customer_profile_broker=cypb&customer_profile_business_unit=BU%20CySEC&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=2022-06-12%2006%3A06%3A02&event_account_name=libertex&event_account_id=2803540796&event_ref=&event_currency=eur&customer_login=&event_value=NaN&event_id=40843668&event_type=edit&product_category=active_investment&customer_id=17620771&page_path=https%3A%2F%2Fapp.libertex.com%2Fm%23investments%2Factive%2FBTCUSD%2F40843668&page_name=Trade%20report&customer_profile_country=AUT&product_id=BTCUSD&page_loadingtime=&fx_visitor_id=5ef3cbf6049be6e5fcb66684f6765fb125a041c347d6df48ef77864fa96ce886&customer_profile_network=Google%20Ads%20ACI&customer_profile_network_name=&device=Samsung%20SM-G950F&Device=&page_loadingtime_tti=&page_activitytime=&page_type="
"/?t_profile=ep-ios&visitor_id=018085823c65000c17e5ef5d7bea0006f00990670056a&client_id=132551133&sf_campaignId=&product_name=&page_system=stormgain&page_language=en&page_channel=sg-ios&product_subcategory=&page_dom_url=&customer_profile_lifecycle=&session_id=1655013964107&customer_profile_is_first_launch_open=1&customer_login=&customer_cur_account_type=real&customer_cur_account_is_deposit=&customer_cur_account_info_code=&customer_cur_account_id=&customer_cur_account_deposit_total_value=&customer_cur_account_deposit_init_value=&customer_cur_account_count_of_deals_total=&customer_cur_account_balance_available=&customer_accounts_info_code=&customer_email=jamalberro.jb%40gmail.com&customer_profile_broker=storm&customer_profile_business_unit=&icid_sf=&page_referrer_long=&page_dom_referrer=&page_category=&page_environment=prod&event_date_utc=2022-06-12%2006%3A06&event_date=&event_account_name=&event_account_id=&event_ref=&event_currency=&customer_login=&event_value=&event_id=&event_type=close&event_type_condition_multiplicator=&event_type_condition_direction=&event_type_condition_value=&customer_account_nbc_wallet_currency=&customer_account_is_nbc_activated=&customer_account_is_nbc_activated_date=&customer_account_nbc_deposit_total_value=&customer_account_nbc_deposit_total_count=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_last_value=&customer_account_nbc_deposit_init_value=&customer_account_nbc_deposit_init_date=&customer_account_nbc_balance_available=&customer_account_count_of_nbc_closed_orders_sbs_ch+&customer_account_count_of_nbc_closed_orders_sbs_rc=&customer_account_count_of_nbc_closed_orders_abs_ch=&customer_account_count_of_nbc_closed_orders_abs_rc=&customer_account_bc_is_activated=&customer_account_is_bc_activated_date=&customer_account_count_of_pending_exchange_orders=&customer_account_is_deposit=&customer_account_bc_deposit_init_value=&customer_account_count_of_trades_close=&customer_account_trades_closed_list=&customer_account_bc_deposit_total_value&customer_account_bc_deposit_last_date=&customer_account_bc_deposit_total_count=&customer_account_bc_deposit_last_value=&customer_account_bc_balance_available=&customer_account_count_of_closed_orders_sbs=&customer_account_count_of_closed_orders_abs=&customer_account_count_of_pending_orders=&customer_account_pending_orders_value=&customer_account_count_of_trades_total=&customer_account_info_code=101&customer_profile_network=No%20User%20Consent&customer_profile_adgroup=&customer_profile_creative=&product_category=modal%20offer&customer_id=132551133&page_path=https%3A%2F%2Fapp.stormgain.com%2Fm%23crypto-miner&page_name=Crypto%20Miner&customer_profile_country=ARE&product_id=mo_sg_less20_v2_en&page_loadingtime=&fx_visitor_id=3357e835012cee2895b51436a1a0708c5f2b82489685577c3e13471fe9b93e8b&device=iPhone14,3&Device=&page_loadingtime_tti=&page_activitytime=&page_type="
```

### Partitioning strategy
Clickstream data is huge in velocity and variety as an estimate we have around 100 million messages per date from
both topics and more than 200 unique columns which makes it a challenge to process this type of data.

The key to analyse these events is to parse them on read and stored them in a way that is easy to retrieve, the
challenge is to define which columns are the most helpful to partition and data and reduce the time of queries.
### Key column proposal
- By date: (year, month, day)
- By identifier:
    - `Client ID` - for events from a known user (client id)
    - `Device ID` - for events from an unknown user (web cookie, iphone id, google id)
- By identifier type (as defined above)
- Origin (mobile or web)
- By event type: (click, install, visit, registration, deposit, withdrawal, etc..)
- Country
- Broker


### Parsing mechanism
The strategy to parse this messages is to explode the queryparams into a hash map where only the necessary strings
can be extracted, disposing of this object immediately afterwards.

Keeping only the partition keys and a copy of the raw event as a single string, this parse will evolve from a single
string and generate a single model (Unified clickstream model).

The chain of transformations will be:

Kafka -> String -> Uri params in map -> Extracted fields -> Unified clickstream model -> Database

### Unified clickstream model
Because the fact that our data is coming from different sources and the need of store this data in a distributed way
in our database to avoid doing full scans when retrieving it, we need to define a structure that the database will
use to store this data with the partition keys defined.


This is our unified clickstream model. Such model can have this proposed structure:
```sql
CREATE TABLE clickstream
(
    `clientId` String null,
    `eventType` String null,
    `country` String null,
    `broker` String null,
    `sessionId` String null,
    `visitorId` String null,
    `gpsAdid` String null,
    `idfa` String null,
    `trackerType` String,
    `createdAt` DateTime32,
    `origin` String,
    `uriParamsJson` String
)
    ENGINE = MergeTree()
        ORDER BY (origin, "trackerType", "sessionId", "visitorId", "gpsAdid", idfa, broker)
        PARTITION BY toYYYYMM("createdAt")
        SETTINGS allow_nullable_key = 1;
```
### DLQ table
Any message that is not properly parsed in the format explained above will be saved on a special table named:
`dlq_<clickstream_table_name>`


### Project resources
To provide resources and information about the advantage and usage of a distributed database such as greenplum to do analysis with a hot/warm data layer.

In this repository you will find:
- **Documentation and examples that include the following use cases:**
    - Resources to provision and configure a greenplum cluster 6.x in RnD AWS account
    - A sample pipeline that will read messages from kafka and saves them as rows on Greenplum database

# Targets
Above we explained the standard of processing clickstream messages which is agnostic of the database technology,
this project includes a service that can insert data into the following targets. It can be extended into different
targets if needed.
- [Clickhouse](#clickhouse)

---------------------
## Clickhouse
ClickHouse is a column-oriented database management system (DBMS) for online analytical processing of queries (OLAP).
### Column oriented vs Row oriented

| Row oriented                                                                                   | Column oriented                                                                                      |
|---------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| ![](https://clickhouse.com/docs/assets/images/row-oriented-d515facb5bffb48cbd09dc7d064c8816.gif#) | ![](https://clickhouse.com/docs/assets/images/column-oriented-b992c529fa4085b63b57452fbbeb27ba.gif#) |

### Key Properties of OLAP Scenario
- The vast majority of requests are for read access.
- Data is updated in fairly large batches (> 1000 rows), not by single rows; or it is not updated at all.
- Data is added to the DB but is not modified.
- For reads, quite a large number of rows are extracted from the DB, but only a small subset of columns.
- Tables are “wide,” meaning they contain a large number of columns.
- Queries are relatively rare (usually hundreds of queries per server or less per second).
- For simple queries, latencies around 50 ms are allowed.
- Column values are fairly small: numbers and short strings (for example, 60 bytes per URL).
- Requires high throughput when processing a single query (up to billions of rows per second per server).
- Transactions are not necessary.
- Low requirements for data consistency.
- There is one large table per query. All tables are small, except for one.
- A query result is significantly smaller than the source data. In other words, data is filtered or aggregated, so
  the result fits in a single server’s RAM.

## Infrastructure
### Development
To test this pipeline locally clickhouse
``` 
docker run -d -p 18123:8123 -p19000:9000 --name some-clickhouse-server --ulimit nofile=262144:262144 clickhouse/clickhouse-server
```
Then connect using a statement such as
```
clickhouse-client --host 172.26.98.82 --port 18123 --user dev-user --password 123456
```

### Production
This service is using port 9000 to connect to production cluster
TBD: implement SSL connection

### More resources
- https://clickhouse.com/docs/en/guides/developer/working-with-json/json-other-approaches/#hybrid-approach-with-materialized-columns
- https://hub.docker.com/r/clickhouse/clickhouse-server/
- https://github.com/ClickHouse/clickhouse-jdbc